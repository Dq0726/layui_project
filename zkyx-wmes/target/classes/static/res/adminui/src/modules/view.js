layui.define(["laytpl","layer"],function(e){var f=layui.jquery;var h=layui.laytpl;var g=layui.layer;var c=layui.setter;var b=layui.device();var d=layui.hint();var j=function(l){return new a(l)};var i="layui-show";var k="LAY_app_body";var a=function(l){this.id=l;this.container=f("#"+(l||k))};j.loading=function(l){l.append(this.elemLoad=f('<i class="layui-anim layui-anim-rotate layui-anim-loop layui-icon layui-icon-loading layadmin-loading"></i>'))};j.removeLoad=function(){this.elemLoad&&this.elemLoad.remove()};j.exit=function(){layui.data(c.tableName,{key:c.request.tokenName,remove:true});g.closeAll();location.hash="/uia/login"};j.req=function(p){var r=this;var s=p.success;var o=p.error;var q=c.request;var n=c.response;var m=function(){return c.debug?"<br><cite>URL：</cite>"+p.url:""};p.data=p.data||{};p.headers=p.headers||{};if(q.tokenName){var l=typeof p.data==="string"?JSON.parse(p.data):p.data;if(q.tokenTransferMethod==="headers"){p.headers[q.tokenName]=q.tokenName in p.headers?p.headers[q.tokenName]:(layui.data(c.tableName)[q.tokenName]||"")}else{p.data[q.tokenName]=q.tokenName in l?p.data[q.tokenName]:(layui.data(c.tableName)[q.tokenName]||"")}}delete p.success;delete p.error;return f.ajax(f.extend({type:"get",dataType:"json",success:function(u){var v=n.statusCode;if(u[n.statusName]==v.ok){typeof p.done==="function"&&p.done(u)}else{if(u[n.statusName]==v.logout){j.exit()}else{var t=["<cite>Error：</cite> "+(u[n.msgName]||"返回状态码异常"),m()].join("");j.error(t)}}typeof s==="function"&&s(u)},error:function(v,u){var t=["请求异常，请重试<br><cite>错误信息：</cite>"+u,m()].join("");j.error(t);typeof o==="function"&&o.apply(this,arguments)}},p))};j.popup=function(l){var n=l.success;var m=l.skin;delete l.success;delete l.skin;return g.open(f.extend({type:1,title:"提示",content:"",id:"LAY-system-view-popup",skin:"layui-layer-admin"+(m?" "+m:""),shadeClose:true,closeBtn:false,success:function(o,p){var q=f('<i class="layui-icon" close>&#x1006;</i>');o.append(q);q.on("click",function(){g.close(p)});typeof n==="function"&&n.apply(this,arguments)}},l))};j.error=function(m,l){return j.popup(f.extend({content:m,maxWidth:300,offset:"t",anim:6,id:"LAY_adminError"},l))};a.prototype.render=function(l,o){var n=this;var m=layui.hash();l=l.replace(/^\//,"");l=(c.paths&&c.paths.views?c.paths.views:c.views)+l+c.engine;f("#"+k).children(".layadmin-loading").remove();j.loading(n.container);f.ajax({url:l,type:"get",dataType:"html",data:{v:layui.cache.version},success:function(q){q="<div>"+q+"</div>";var r=f(q).find("title"),s=r.text()||(q.match(/\<title\>([\s\S]*)\<\/title>/)||[])[1];var p={title:s,body:q};r.remove();n.params=o||{};if(n.then){n.then(p);delete n.then}n.parse(q);j.removeLoad();if(n.done){n.done(p);delete n.done}},error:function(p){j.removeLoad();if(n.render.isError){return j.error("请求视图文件异常，状态："+p.status)}if(p.status===404){n.render("template/tips/404")}else{n.render("template/tips/error")}n.render.isError=true}});return n};a.prototype.parse=function(p,s,u){var r=this;var q=typeof p==="object";var n=q?p:f(p);var l=q?p:n.find("*[template]");var m=layui.hash();var t=function(w){var v=h(w.dataElem.html());var x=f.extend({params:m.params},w.res);w.dataElem.after(v.render(x));typeof u==="function"&&u();try{w.done&&new Function("d",w.done)(x)}catch(y){console.error(w.dataElem[0],"\n存在错误回调脚本\n\n",y)}};n.find("title").remove();r.container[s?"after":"html"](n.children());m.params=r.params||{};for(var o=l.length;o>0;o--){(function(){var w=l.eq(o-1),A=w.attr("lay-done")||w.attr("lay-then"),v=h(w.attr("lay-url")||"").render(v),x=h(w.attr("lay-data")||"").render(v),z=h(w.attr("lay-headers")||"").render(v);try{x=new Function("return "+x+";")()}catch(y){d.error("lay-data: "+y.message);x={}}try{z=new Function("return "+z+";")()}catch(y){d.error("lay-headers: "+y.message);z=z||{}}if(v){j.req({type:w.attr("lay-type")||"get",url:v,data:x,dataType:"json",headers:z,success:function(B){t({dataElem:w,res:B,done:A})}})}else{t({dataElem:w,done:A})}}())}return r};a.prototype.send=function(l,n){var m=h(l||this.container.html()).render(n||{});this.container.html(m);return this};a.prototype.refresh=function(o){var n=this,m=n.container.next(),l=m.attr("lay-templateid");if(n.id!=l){return n}n.parse(n.container,"refresh",function(){n.container.siblings('[lay-templateid="'+n.id+'"]:last').remove();typeof o==="function"&&o()});return n};a.prototype.then=function(l){this.then=l;return this};a.prototype.done=function(l){this.done=l;return this};e("view",j)});