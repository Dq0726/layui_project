<div class="layui-form" lay-filter="zkmes-qcmgmt-processtest-form" style="padding: 10px 30px 0 0">
  <div class="layui-form-item">
  <!-- 选择产品 selectProduct-->
    <div class="layui-inline">
      <label class="layui-form-label">产品名称<span class="required">*</span></label>
     <div class="layui-input-inline">
        <div style="display: flex">
          <script type="text/html" template>
            <input
              type="text"
 			  lay-affix="search"
              lay-filter="searchProduct"
              lay-verify="required"
 			  readonly 
              placeholder="请选择"
              value="{{ d.params.productName || '' }}"
              name="productName"
              lay-options="{split: true}"
              class="layui-input" 
            /> 
          </script>
        </div>
      </div>
    </div>
    <!-- 产品名称 productName-->
     <div class="layui-inline">
      <label class="layui-form-label">产品编码</label>
      <div class="layui-input-inline">
        <script type="text/html" template> 
  		 	<input
              type="text" 
              name="productId"
              placeholder="请输入"
              value="{{ d.params.productId || '' }}"
              autocomplete="off"
              class="layui-input"
              disabled
            />
        </script>
      </div>
    </div>  
    
    <!-- 型号 modelName-->
     <div class="layui-inline">
      <label class="layui-form-label">型号</label>
      <div class="layui-input-inline">
        <script type="text/html" template>
          <input
            type="text"
            id="modelName"
            name="modelName"
            placeholder="请输入"
            value="{{ d.params.modelName || '' }}"
            autocomplete="off"
            class="layui-input"
            disabled
          />
        </script>
      </div>
    </div>
    
     <!-- 单位 unit-->
    <div class="layui-inline">
      <label class="layui-form-label">单位</label>
      <div class="layui-input-inline">
        <script type="text/html" template>
          <input
            type="text"
            id="uomName"
            name="uomName"
            placeholder="请输入"
            value="{{ d.params.uomName || '' }}"
            autocomplete="off"
            class="layui-input"
            disabled
          />
        </script>
      </div>
    </div> 
  </div>
 
  <fieldset class="layui-elem-field layui-field-title">
    <legend>检验信息</legend>
  </fieldset>
  
  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">检验单编号<span class="required">*</span></label>
      <div class="layui-input-inline">
        <script type="text/html" template>
			{{# if(d.params.processtestId == null){ }}
          <input
            type="text" 
            name="processtestId"
            placeholder="请输入"
            value="{{ d.params.processtestId || '' }}" 
            autocomplete="off"
            class="layui-input"
            lay-verify="required"
          />
			{{# }else{ }}
          <input
            type="text" 
            name="processtestId"
            placeholder="请输入"
            value="{{ d.params.processtestId || '' }}" 
            autocomplete="off"
            class="layui-input"
            lay-verify="required"
			disabled
          />
			{{# } }} 
        </script>
      </div>
    </div> 
    
    
    <div class="layui-inline">
      <label class="layui-form-label">检验工序</label>
      <div class="layui-input-inline">
        <script type="text/html" template>
          <input
            type="text" 
            name="processId"
            placeholder="请输入"
            value="{{ d.params.processId || '' }}" 
            autocomplete="off"
            class="layui-input"
          />
        </script>
      </div>
    </div> 
    
      <!-- 生产车间 workshop-->
    <div class="layui-inline">
      <label class="layui-form-label">生产车间</label>
      <div class="layui-input-inline">
        <div id="workshopXmselect" class="xm-select-demo"></div>
      </div>
    </div>
    <!-- 班组 teamXmselect-->
    <div class="layui-inline">
      <label class="layui-form-label">班组</label>
      <div class="layui-input-inline">
        <div id="teamXmselect" class="xm-select-demo"></div>
      </div>
    </div>
    
    
  </div>
  
  <div class="layui-form-item"> 
  
   
    <div class="layui-inline">
      <label class="layui-form-label">检验数量<span class="required">*</span></label>
      <div class="layui-input-inline">
        <script type="text/html" template>
          <input
            type="text"
            id="testsQty"
            name="testsQty"
            placeholder="请输入"
            value="{{ d.params.testsQty || '' }}" 
            autocomplete="off"
            class="layui-input"
            lay-verify="required"
          />
        </script>
      </div>
    </div> 
        <div class="layui-inline">
      <label class="layui-form-label">不良数量<span class="required">*</span></label>
      <div class="layui-input-inline">
        <script type="text/html" template>
          <input
            type="text"
            id="defectQty"
            name="defectQty"
            placeholder="请输入"
            value="{{ d.params.defectQty || '' }}" 
            autocomplete="off"
            class="layui-input"
            lay-verify="required"
          />
        </script>
      </div>
    </div>
            <div class="layui-inline">
      <label class="layui-form-label">不良率<span class="required">*</span></label>
      <div class="layui-input-inline">
        <div style="display: flex">
        <script type="text/html" template>
          <input
            type="text" 
            name="defectrate"
			id="defectrate"
            placeholder="请输入"
            value="{{ d.params.defectrate || '' }} " 
            autocomplete="off"
            class="layui-input"
            lay-verify="required"
          />
 			<button type="button" class="layui-btn layui-btn-primary" lay-on="comp">计算</button>
        </script>
         </div>
      </div>
    </div>
          <!-- 检验结果 inspectionResults-->
    <div class="layui-inline">
      <label class="layui-form-label">检验结果</label>
      <div class="layui-input-inline">
        <input type="radio" name="testsResults" value="0" title="合格" />
        <input type="radio" name="testsResults" value="1" title="不合格" />
      </div>
    </div>

  </div>
  <div class="layui-form-item"> 
        <div class="layui-inline">
      <label class="layui-form-label">质检方式</label>
      <div class="layui-input-inline">
        <script type="text/html" template>
          <input
            type="text" 
            name="testsWay"
            placeholder="请输入"
            value="{{ d.params.testsWay || '' }}" 
            autocomplete="off"
            class="layui-input"
          />
        </script>
      </div>
    </div>
        <div class="layui-inline">
      <label class="layui-form-label">检验员</label>
      <div class="layui-input-inline">
        <script type="text/html" template>
          <input
            type="text" 
            name="inspector"
            placeholder="请输入"
            value="{{ d.params.inspector || '' }}" 
            autocomplete="off"
            class="layui-input"
          />
        </script>
      </div>
    </div>
    <div class="layui-inline">
      <label class="layui-form-label">检验时间</label>
      <div class="layui-input-inline">
        <input
          type="text"
          id="ID-laydate-testsTime"
          placeholder="请输入"
          name="testsTime"
          autocomplete="off"
          class="layui-input"
        />
      </div>
    </div>
  </div>
   
  <div class="layui-form-item">
    <label class="layui-form-label">检验说明</label>
    <div class="layui-input-block">
      <script type="text/html" template>
        <textarea type="text" name="remark" autocomplete="off" class="layui-textarea">{{ d.params.remark || '' }}</textarea>
      </script>
    </div>
  </div>
  
  
  
  <div class="layui-form-item">
    <label class="layui-form-label"></label>
    <div class="layui-input-inline">
      <input
        type="button"
        id="zkmes-qcmgmt-processtest-form-submit"
        lay-submit
        lay-filter="zkmes-qcmgmt-processtest-form-submit"
        value="确认"
        class="layui-btn"
      />
    </div>
  </div>
</div>

<script type="text/html" template lay-done="layui.data.sendZkmesInvmgmtPurchaseorderEditFormParams(d.params)"></script>

<script>
  layui.data.sendZkmesInvmgmtPurchaseorderEditFormParams = function (params) {
    layui.use(["admin", "form", "xmSelect","common"],  function () {
      var $ = layui.$,
        admin = layui.admin,
        view = layui.view,
        table = layui.table,
        form = layui.form,
        laydate = layui.laydate,
        util = layui.util,
        common = layui.common,
        xmSelect = layui.xmSelect;
      
      // 调用 common.js 模块 getPopupSize 函数，用 ES6 解构赋值获取返回的两个参数
      const { popupWidthHeight, popupOffsetWidthHeight } = common.getPopupSize();
      ///////product
      form.on("input-affix(searchProduct)", function (data) {
        admin.popup({
          title: "选择产品/物料信息",
          area: popupWidthHeight,
          offset: popupOffsetWidthHeight,
          id: "popup-zkmes-qcmgmt-processtest-form-product",
          success: function (layero, index) {
            view(this.id)
              .render("zkmes/qcmgmt/processtest/product-form")
              .done(function () {
                form.render(null, "zkmes-qcmgmt-processtest-product-form");
                //提交
                form.on(
                  "submit(zkmes-qcmgmt-processtest-product-form-submit)",
                  function (data) {
                    var field = data.field; //获取提交的字段
                    console.log(field);
                    form.val("zkmes-qcmgmt-processtest-form", field); 
                    layer.msg("选择成功");
                    layer.close(index); //执行关闭
                  }
                );
              });
          },
        });
      });
      
	    /* 检验日期 */
      laydate.render({
          elem: "#ID-laydate-testsTime",
          value: params.testsTime,
          isInitValue: true,
          type: "date",
          fullPanel: true,
        });
      
      
      /* 生产车间 */
      var workshopIds = params.workshopId + "";
      if (workshopIds) {
    	  workshopIds = workshopIds.split(",");
      }
      admin.req({
          url: "/zkmes/workshopmgmt/workshop/list1",
          type: "get",
          contentType: "application/json;charset=UTF-8",
          done: function (res) { 
        	  workshopXmselect = xmSelect.render({
              el: "#workshopXmselect",
              name: "workshopId",
              data: res.data,
              radio: true,
              initValue: workshopIds,
              prop: {
                name: "workshopName",
                value: "workshopId", 
              },
            });
          },
        });
      util.on("lay-on", {
          // 获取验证码
          comp: function (othis) {
            // 获取当前页接口数据
	
			if($("#defectQty").val() && $("#testsQty").val() !== ""){
				 var defectrate = ($("#defectQty").val()/$("#testsQty").val())* 100;
			     $("#defectrate").val(Math.round(defectrate* 100)/100+"%");
			}else if($("#testsQty").val() === "")  {
				layer.msg('请输入检验数量');
			}else if($("#defectQty").val() === "")  {
				layer.msg('请不良数量');;
			}
          
          },
        });
      /* 班组 */
      var teamIds = params.teamId + "";
      if (teamIds) {
    	  teamIds = teamIds.split(",");
      }
      admin.req({
          url: "/zkmes/schedulingmgmt/team/list1",
          type: "get",
          contentType: "application/json;charset=UTF-8",
          done: function (res) { 
        	  teamsGroupsXmselect = xmSelect.render({
              el: "#teamXmselect",
              name: "teamId",
              data: res.data,
              radio: true,
              initValue: teamIds,
              prop: {
                name: "teamName",
                value: "teamId", 
              },
            });
          },
        });
       
      
      if(params.testsResults){
    	  $("input[name=testsResults][value=0]").attr("checked", params.testsResults == 0 ? true : false);
          $("input[name=testsResults][value=1]").attr("checked", params.testsResults == 1 ? true : false);
      }else{
    	  $("input[name=testsResults][value=0]").attr("checked", true);
      }
     
      
      
      
      form.render(null);
    });
  };


  layui.use(["admin", "form",'common'], function () {
	    var $ = layui.$,
	      admin = layui.admin,
	      view = layui.view,
	      table = layui.table,
	      laydate = layui.laydate,
	      common = layui.common, 
	      form = layui.form;

	      // 调用 common.js 模块 getPopupSize 函数，用 ES6 解构赋值获取返回的两个参数
	      const { popupWidthHeight, popupOffsetWidthHeight } = common.getPopupSize(); 
	  });




</script>
