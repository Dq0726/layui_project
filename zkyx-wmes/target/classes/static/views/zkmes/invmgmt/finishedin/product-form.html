<div class="layui-form" lay-filter="zkmes-invmgmt-finishedin-product-form" style="padding: 10px 30px 0 0">
   
  
 <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">物料编码</label>
      <div class="layui-input-inline"> 
          <input type="text" id="productId" name="productId" placeholder="请输入"  autocomplete="off" class="layui-input" /> 
      </div>
    </div> 
    
    <div class="layui-inline">
      <label class="layui-form-label">物料名称</label>
      <div class="layui-input-inline"> 
          <input type="text" id="productName" name="productName" placeholder="请输入"  autocomplete="off" class="layui-input" /> 
      </div>
    </div> 
    
    <div class="layui-inline">
      <label class="layui-form-label">型号</label>
      <div class="layui-input-inline"> 
          <input type="text" id="modelId" name="modelId" placeholder="请输入"  autocomplete="off" class="layui-input" /> 
      </div>
    </div> 
    
     <div class="layui-inline">
      <label class="layui-form-label">规格</label>
      <div class="layui-input-inline"> 
          <input type="text" id="specId" name="specId" placeholder="请输入"  autocomplete="off" class="layui-input" /> 
      </div>
    </div>  
  </div>
  
  
  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">供应商</label>
      <div class="layui-input-inline"> 
          <input type="text" id="supplierName" name="supplierName" placeholder="请输入"  autocomplete="off" class="layui-input" /> 
      </div>
    </div> 
    
    <div class="layui-inline">
      <label class="layui-form-label">分类</label>
      <div class="layui-input-inline"> 
          <input type="text" id="classifyName" name="classifyName" placeholder="请输入"  autocomplete="off" class="layui-input" /> 
      </div>
    </div> 
    
   <div class="layui-inline zkmes-invmgmt-finishedin-product-form-search">
      <label class="layui-form-label"></label>
      <div class="layui-input-inline"> 
          <button class="layui-btn " data-type="reload">搜索</button>
      </div>
    </div> 
  </div>
  
 
  
  
  
  <div class="layui-form-item">
    <table id="zkmes-invmgmt-finishedin-product-form-table" lay-filter="zkmes-invmgmt-finishedin-product-form-table"></table>
    <script type="text/html" id="zkmes-invmgmt-finishedin-product-form-toolbar-head">
      <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="add">新增</button>
        <button class="layui-btn layui-btn-sm" lay-event="refresh">刷新</button>
      </div>
    </script>

    <script type="text/html" id="zkmes-invmgmt-finishedin-product-form-toolbar-row">
      <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit"><i class="layui-icon layui-icon-edit"></i>编辑</a>
      <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
    </script>
  </div>

  <div class="layui-form-item layui-hide">
    <label class="layui-form-label"></label>
    <div class="layui-input-inline">
      <input type="button" id="zkmes-invmgmt-finishedin-product-form-submit" lay-submit lay-filter="zkmes-invmgmt-finishedin-product-form-submit" value="确认" class="layui-btn" />
    </div>
  </div>
</div>

  
<script>
    
  layui.use(["admin", "form"], function () {
    var $ = layui.$,
      admin = layui.admin,
      view = layui.view,
      table = layui.table,
      form = layui.form;

    active = {
 	    reload: function(){ 
 	      var productId = $('#productId'); 
 	     //执行重载
	      table.reloadData('zkmes-invmgmt-finishedin-product-form-table', {
	        page: {
	          curr: 1 //重新从第 1 页开始
	        }
	        ,where: { 
	        	  productId: productId.val() 
	        }
	      }); 
 	    } 
 	  };
    	  
    	  
   	$('.zkmes-invmgmt-finishedin-product-form-search .layui-btn').on('click', function(){
       var type = $(this).data('type');
       active[type] ? active[type].call(this) : '';
    });
     
    var prefix = "zkmes/productmgmt/product";

    table.render({
      elem: "#zkmes-invmgmt-finishedin-product-form-table",
      url: prefix + "/list",  
      toolbar: "#zkmes-invmgmt-finishedin-product-form-toolbar-head",
      page: true,
      defaultToolbar: [
        "filter",
        "print",
        "exports",
        {
          title: "提示",
          layEvent: "LAYTABLE_TIPS",
          icon: "layui-icon-tips",
        },
      ],
      height: "full-350",
      cols: [
        [
     	  { field: 'productId', title: '物料编码' }  
           , { field: 'productName', title: '物料名称' }   
           , { field: 'modelName', title: '型号' }  
           , { field: 'specName', title: '规格' }  
           , { field: 'uomName', title: '计量单位' }  
           , { field: 'supplierName', title: '供应商' } 
           , { field: 'classifyName', title: '分类' }  
           ,{ title: "操作", width: 160, align: "center", fixed: "right", toolbar: "#zkmes-invmgmt-finishedin-product-form-toolbar-row" },
        ],
      ],
    });
    
    
  //触发行双击事件
    table.on('rowDouble(zkmes-invmgmt-finishedin-product-form-table)', function(obj){
    	 // console.log(obj.tr) //得到当前行元素对象
    	 // console.log(obj.data) //得到当前行数据
    	   
    	  var submit  = $("#zkmes-invmgmt-finishedin-product-form-submit")  
    	  var data = form.val('zkmes-invmgmt-finishedin-product-form', JSON.parse(JSON.stringify(obj.data)));
    	   
    	  form.render();
    	  
    	  //alert(JSON.stringify(data));
    	  
    	  submit.trigger('click');
    });
     
    // 头部工具栏点击事件
    table.on('toolbar(zkmes-invmgmt-finishedin-product-form-table)', function (obj) {
      switch (obj.event) {
        case 'add':
          admin.popup({
            title: '添加采购入库信息'
            , area: '800px'
            , offset: '100px'
            , id: 'popup-zkmes-invmgmt-finishedin-product-form-add'
            , success: function (layero, index) {
              view(this.id).render('zkmes/invmgmt/finishedin-product/form').done(function () {
                form.render(null, 'zkmes-invmgmt-finishedin-product-form');
                //提交
                form.on('submit(zkmes-invmgmt-finishedin-product-form-submit)', function (data) {
                  var field = data.field; //获取提交的字段 
                  field.status = field.status ? 0 : 1;
                  //提交 Ajax 成功后，关闭当前弹层并重载表格
                  admin.req({
                	  url: prefix  
                    , type: 'post'
                    , contentType: 'application/json;charset=UTF-8'
                    , data: JSON.stringify(field)
                    , done: function (res) {
                      layer.msg("新增成功");
                      layui.table.reload('zkmes-invmgmt-finishedin-product-table'); //重载表格
                      layer.close(index); //执行关闭 
                    }
                  });
                });
              });
            }
          });
          break;
        case 'delete':
          layer.msg('删除');
          break;
        case 'update':
          layer.msg('编辑');
          break;
        case 'LAYTABLE_TIPS':
          layer.msg('提示');
          break;
      }
    });
     
  });
</script>
