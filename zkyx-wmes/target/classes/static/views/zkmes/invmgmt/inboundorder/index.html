<title>入库单</title>

<div class="layui-card layadmin-header">
  <div class="layui-breadcrumb" lay-filter="breadcrumb">
    <a lay-href="">主页</a>
    <a><cite>中科MES</cite></a>
    <a><cite>库存管理</cite></a>
    <a><cite>入库单</cite></a>
  </div>
</div>

<div class="layui-fluid">
  <div class="layui-card">
    <div class="layui-card-body">
      <table id="zkmes-invmgmt-inboundorder-table" lay-filter="zkmes-invmgmt-inboundorder-table"></table>

      <script type="text/html" id="zkmes-invmgmt-inboundorder-toolbar-head">
	    <div class="layui-btn-container">   
		  <button class="layui-btn layui-btn-sm" lay-event="refresh">刷新</button>
	    </div>
	  </script>

      <script type="text/html" id="zkmes-invmgmt-inboundorder-toolbar-row"> 
        <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit"><i class="layui-icon layui-icon-edit"></i>编辑</a>

      </script>

    </div>
  </div>
</div>

<script>
  layui.use(['admin', 'table'], function () {
    var $ = layui.$
      , admin = layui.admin
      , view = layui.view
      , table = layui.table
      , form = layui.form;

    var prefix = "zkmes/invmgmt/inboundorder";

    
    table.render({
      elem: '#zkmes-invmgmt-inboundorder-table'
      , url: prefix + '/list'  
      , toolbar: '#zkmes-invmgmt-inboundorder-toolbar-head'
      , page: true 
      , defaultToolbar: ['filter', 'print', 'exports', {
        title: '提示',
        layEvent: 'LAYTABLE_TIPS',
        icon: 'layui-icon-tips'
      }]
      , height: 'full-200'
      , cols: [[ 
    	  { field: 'inboundorderId', title: '订单单号' }     
    	  ,{field: 'iotId', title: '入库类型' , templet: function (res) { 
				var text = "未知"; 
			    if(res.iotId == 1){
					text = "采购订单生成"
				}else if(res.iotId == 2){
					text = "成品入库"
				} else if(res.iotId == 3){
					text = "半成品入库"
				}  
				return text;
            }
          }   
        , { field: 'createTime', title: '填单时间' }
        , { field: 'createBy', title: '制表人' }   
        , {
            field: "status",
            title: "状态",
            templet: function (res) {
              var html = "-";
              if (res.status == 0) {
                html = '<span class="layui-badge layui-bg-blue">未知</span>';
              } else if (res.status == 1 ) {
                html = '<span class="layui-badge layui-bg-green">待确认仓库</span>';
              }else if (res.status == 2 ) {
                html = '<span class="layui-badge layui-bg-green">已确认仓库，待入库</span>';
              } else if (res.status == 3 ) {
                html = '<span class="layui-badge layui-bg-green">已完成</span>';
              } 
              return html;
            },
          }
        , { field: 'remark', title: '备注' }  
        , { title: '操作', width: 160, align: 'center', fixed: 'right', toolbar: '#zkmes-invmgmt-inboundorder-toolbar-row' }
      ]]
    });

    //工具条
    table.on('tool(zkmes-invmgmt-inboundorder-table)', function (obj) {
      var data = obj.data;
      if (obj.event === 'edit') {
        admin.popup({
          title: '修改入库单信息'
         , area: '1500px'
          , offset: '100px'
          , id: 'popup-zkmes-invmgmt-inboundorder-edit'
          , success: function (layero, index) {
            view(this.id).render('zkmes/invmgmt/inboundorder/form', data).done(function () {
              form.render(null, 'zkmes-invmgmt-inboundorder-form');

              //提交
              form.on('submit(zkmes-invmgmt-inboundorder-form-submit)', function (data) {
            	  
            	  	layui.table.reload('zkmes-invmgmt-inboundorder-table'); //重载表格
                  layer.close(index); //执行关闭 
      
                
              });
            });
          }
        });
      }
    });

    // 头部工具栏点击事件
    table.on('toolbar(zkmes-invmgmt-inboundorder-table)', function (obj) {
      switch (obj.event) { 
        case 'delete':
          layer.msg('删除');
          break;
        case 'update':
          layer.msg('编辑');
          break;
        case 'LAYTABLE_TIPS':
          layer.msg('提示');
          break;
        case "refresh":
          layui.table.reloadData("zkmes-invmgmt-inboundorder-table"); //重载表格
          break;
      }
    });
  
  });
</script>