<div class="layui-form" lay-filter="zkmes-planschedulingmgmt-productionscheduling-form" style="padding: 10px 30px 0 0">
  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">生产订单编号</label>
      <div class="layui-input-block">
        <script type="text/html" template>
          <input
            type="text"
            id="productionplanId"
            name="productionplanId"
            placeholder="请输入"
            value="{{ d.params.productionplanId || '' }}"
            autocomplete="off"
            class="layui-input"
          />
        </script>
      </div>
    </div>

    <div class="layui-inline">
      <label class="layui-form-label">生产数量</label>
      <div class="layui-input-block">
        <script type="text/html" template>
          <input
            type="text"
            id="qty"
            name="qty"
            placeholder="请输入"
            value="{{ d.params.qty || '' }}"
            autocomplete="off"
            class="layui-input"
          />
        </script>
      </div>
    </div>
  </div>

  <div class="layui-form-item">
    <div class="layui-tab layui-tab-brief" lay-filter="test-handle">
      <ul class="layui-tab-title"></ul>
      <div class="layui-tab-content"></div>
    </div>
  </div>
</div>

<script
  type="text/html"
  template
  lay-done="layui.data.sendZkmesProductmanageProductionschedulingFormParams(d.params)"
></script>

<script>
  currentId = null;

  layui.data.sendZkmesProductmanageProductionschedulingFormParams = function (params) {
    layui.use(["admin", "form"], function () {
      var $ = layui.$,
        admin = layui.admin,
        view = layui.view,
        element = layui.element,
        form = layui.form;

      admin.req({
        url: "/zkmes/techniquemgmt/techniquegroup/list1",
        type: "get",
        data: {
          techniqueId: params.techniqueId,
        },
        contentType: "application/json;charset=UTF-8",
        done: function (res) {
          var arr = res.data;

          for (var i = 0; i < arr.length; i++) {
            var tab = arr[i];
            var url = "/views/zkmes/productionmgmt/productionscheduling/" + tab.tag + "/index.html";

            //请求模板
            $.ajax({
              url: url,
              type: "get",
              dataType: "html",
              async: false,
              data: {
                v: layui.cache.version,
              },
              success: function (html) {
                var h =
                  "<div><input type='text' class='layui-input layui-hide' id='processId' value='" +
                  tab.processId +
                  "' /><div>";

                html = h + html;

                element.tabAdd("test-handle", {
                  title: tab.processName,
                  content: html,
                  id: tab.techniquegroupId,
                });
              },
              error: function (data) {
                //响应失败执行该函数，比如404,500,405等
                element.tabAdd("test-handle", {
                  title: tab.processName,
                  content: "",
                  id: tab.techniquegroupId,
                });
              },
            });
          }

          element.tabChange("test-handle", arr[0].techniquegroupId); // 切换到：标签1
        },
      });
    });
  };

  layui.use(["admin", "form"], function () {
    var $ = layui.$,
      admin = layui.admin,
      view = layui.view,
      element = layui.element,
      form = layui.form;

    element.on("tab(test-handle)", function (data) {
      currentId = this.getAttribute("lay-id");
    });
  });
</script>
