<div class="layui-form" lay-filter="system-role-permis-form" style="padding: 10px 30px 0 0">
  <input
    type="text"
    id="menuIds"
    name="menuIds"
    placeholder="请输入"
    autocomplete="off"
    class="layui-input layui-hide"
  />

  <!--    传值给父start -->
  <div class="layui-form-item layui-hide">
    <div class="layui-inline">
      <label class="layui-form-label">产品分类编号</label>
      <div class="layui-input-inline">
        <input type="text" name="classifyId" placeholder="请输入" autocomplete="off" class="layui-input" />
      </div>
    </div>
    <div class="layui-inline">
      <label class="layui-form-label">产品分类名称</label>
      <div class="layui-input-inline">
        <input type="text" name="classifyName" placeholder="请输入" autocomplete="off" class="layui-input" />
      </div>
    </div>
  </div>

  <!--    传值给父end -->

  <!--    search start -->
  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">产品分类编号</label>
      <div class="layui-input-inline">
        <input type="text" id="classifyId" placeholder="请输入" autocomplete="off" class="layui-input" />
      </div>
    </div>
    <div class="layui-inline">
      <label class="layui-form-label">产品分类名称</label>
      <div class="layui-input-inline">
        <input type="text" id="classifyName" placeholder="请输入" autocomplete="off" class="layui-input" />
      </div>
    </div>
    <div class="layui-inline system-role-permis-form-search">
      <div class="layui-input-inline">
        <button class="layui-btn" data-type="reload">搜索</button>
      </div>
    </div>
  </div>

  <!--    search end -->

  <div class="layui-form-item">
    <table id="system-role-permis-form-table" lay-filter="system-role-permis-form-table"></table>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label"></label>
    <div class="layui-input-inline">
      <input type="button" id="system-role-permis-form-confirm" value="确认" class="layui-btn" />

      <input
        type="button"
        id="system-role-permis-form-submit"
        lay-submit
        lay-event="getChecked"
        lay-filter="system-role-permis-form-submit"
        value="确认"
        class="layui-btn layui-hide"
      />
    </div>
  </div>
</div>

<script type="text/html" template lay-done="systemRolePermisFormParamsDone(d.params)"></script>

<script>
systemRolePermisFormParamsDone = function (params) {
    layui.use(["admin", "form"], function () {
      var $ = layui.$,
        admin = layui.admin,
        view = layui.view,
        table = layui.table,
        form = layui.form,
        treeTable = layui.treeTable;
 
      var prefix = "system/menu";

      //菜单管理
      treeTable.render({
        elem: "#system-role-permis-form-table",
        id: "system-role-permis-form-table-id",
        url: prefix + "/list",
        toolbar: "#system-menu-toolbar-head",
        defaultToolbar: [
          "filter",
          "print",
          "exports",
          {
            title: "提示",
            layEvent: "LAYTABLE_TIPS",
            icon: "layui-icon-tips",
          },
        ],
        height: "full-280",
        tree: {
          customName: {
            id: "menuId", //父ID
            pid: "parentId", //子ID
            name: "menuName",
          },
          data: {
            isSimpleData: true,
          },
          view: {
            showIcon: false,
            expandAllDefault: false,
          },
        },
        cols: [
          [
            { type: "checkbox", fixed: "left" },
            { field: "menuName", title: "名称" },
            { field: "status", title: "状态" },
          ],
        ],
        style: "margin-top:0;",
        parseData: function (res) { 
          var j = 0;
       
          if(params != null){
          	if( Object.keys(params).length > 0){
          		var menuIds = params.split(","); 
              for (var i = 0; i < menuIds.length; i++) {
                for (var j = 0; j < res.data.length; j++) {
                  if (res.data[j].menuId == menuIds[i]) {
                    res.data[j].LAY_CHECKED = true;
                    break;
                  }
                }
              } 
          	} 
          }
         
          

        
          
          return {
            code: res.code, // 解析接口状态
            msg: res.msg, // 解析提示文本
            data: res.data, // 解析数据列表
          };
        },
        done: function (res, curr, count, origin) {  
          table.setRowChecked("test", {
            index: 0, // 选中行的下标。 0 表示第一行
          });
        },
        response: {
          statusName: "code", //数据状态的字段名称，默认：code
          statusCode: 200, //成功的状态码，默认：0
          msgName: "msg", //状态信息的字段名称，默认：msg
          dataName: "data", //数据列表的字段名称，默认：data
        },
      });

      // 为确认按钮绑定点击事件
      $("#system-role-permis-form-confirm").on("click", function () {
        //  var tableId = insTb.config.id;
        var status = treeTable.checkStatus("system-role-permis-form-table-id", true);

        var data = status.data;

        if (!data.length) return layer.msg("无选中数据");

        var arr = [];

        for (var i = 0; i < data.length; i++) {
          arr.push(data[i].menuId);
        }

        var submit = $("#system-role-permis-form-submit");
        var data = form.val("system-role-permis-form", {
          menuIds: arr,
        });

        form.render();
        submit.trigger("click");
      });
    });
  };
  
  
  
  
  layui.use(['admin', 'form', 'xmSelect'], function () {
    var $ = layui.$
      , admin = layui.admin
      , view = layui.view
      , form = layui.form
      , xmSelect = layui.xmSelect;

 			active = {
        reload: function () {
          var classifyId = $("#classifyId");
          //执行重载
          table.reloadData("system-role-permis-form-table", { 
            where: {
              classifyId: classifyId.val(),
            },
          });
        },
      };

      $(".system-role-permis-form-search .layui-btn").on("click", function () {
        var type = $(this).data("type");
        active[type] ? active[type].call(this) : "";
      }); 
 });
  
  
  
</script>




  
  
