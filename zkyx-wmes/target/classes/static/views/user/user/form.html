<div class="layui-form" lay-filter="user-user-form" style="padding: 20px 30px 0 0;">



  <div class="layui-form-item">
    <label class="layui-form-label">登录名</label>
    <div class="layui-input-block">
      <script type="text/html" template>
        <input type="text" name="id" placeholder="请输入"  style="display: none" value="{{ d.params.id || '' }}"  autocomplete="off" class="layui-input">
        <input type="text" name="user_name" value="{{ d.params.user_name || '' }}" lay-verify="required" placeholder="请输入用户名" autocomplete="off" class="layui-input">
      </script>
    </div>
  </div>


  <div class="layui-form-item">

    <div class="layui-inline">
      <label class="layui-form-label">昵称</label>
      <div class="layui-input-inline">
        <script type="text/html" template>
        <input type="text" name="nick_name" value="{{ d.params.nick_name || '' }}" lay-verify="required" placeholder="请输入用户名" autocomplete="off" class="layui-input">
         </script>
      </div>
    </div>
    <div class="layui-inline">
      <label class="layui-form-label">性别</label>
      <div class=layui-input-block>
        <script type="text/html" template lay-done="layui.data.sexDone(d)">
                <input type="radio" name="sex" value=1 title="男">
                <input type="radio" name="sex" value=2 title="女">
                <input type="radio" name="sex" value=0 title="未知"  checked >
                <input type="radio" name="sex" value=9 title="未说明">
         </script>
      </div>
    </div>
  </div>



  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">手机号码</label>
      <div class="layui-input-inline">
        <script type="text/html" template>
        <input type="text" name="cellphone" value="{{ d.params.cellphone || '' }}" lay-verify="phonemsg" placeholder="请输入号码" autocomplete="off" class="layui-input">
      </script>
      </div>
    </div>
    <div class="layui-inline">
      <label class="layui-form-label">固定号码</label>
      <div class="layui-input-inline">
        <script type="text/html" template>
        <input type="text" name="telephone" value="{{ d.params.telephone || '' }}"  placeholder="请输入号码"  autocomplete="off" class="layui-input">
      </script>
      </div>
    </div>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label">邮箱</label>
    <div class="layui-input-inline">
      <script type="text/html" template>
        <input type="text" name="email" value="{{ d.params.email || '' }}" lay-verify="emailmsg" placeholder="请输入邮箱" autocomplete="off" class="layui-input">
      </script>
    </div>
  </div>


  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">角色</label>
      <div class="layui-input-inline">
        <script type="text/html" template lay-done="layui.data.UserRoleDone(d)">
         <div id="userRoleXmselect" class="xm-select-demo"></div> 
      </script>
      </div>
    </div>

    <div class="layui-inline">
      <label class="layui-form-label">组织</label>
      <div class="layui-input-inline">
        <script type="text/html" template lay-done="layui.data.UserOrgDone(d)">
        	<div id="userOrgXmselect" class="xm-select-demo"></div> 
  		 </script>
      </div>

    </div>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label"></label>
    <div class="layui-input-inline">
      <input type="button" lay-submit id="user-user-form-submit" lay-filter="user-user-form-submit" value="确认"
        class="layui-btn">
    </div>
  </div>
</div>

<script>


  layui.data.sexDone = function (d) {
    layui.use(['admin', 'form', 'xmSelect'], function () {
      var $ = layui.$
        , admin = layui.admin
        , view = layui.view
        , form = layui.form
        , xmSelect = layui.xmSelect;

      if(d.params.sex == null)
      	 d.params.sex = 0;

      form.val("user-user-form", {
        sex: d.params.sex,
      });

    })
  }

  layui.data.UserRoleDone = function (d) {

    layui.use(['admin', 'form', 'xmSelect'], function () {
      var $ = layui.$
        , admin = layui.admin
        , view = layui.view
        , form = layui.form
        , xmSelect = layui.xmSelect;

 
      var v;
      if (d.params.role_code) {
        v = d.params.role_code.split(",")
      }

      admin.req({
        url: '/inet/services/user/role/list' //模拟接口
        , type: 'get'
        , contentType: 'application/json;charset=UTF-8'
        , done: function (res) {
          roleOrgXmselect = xmSelect.render({
            el: '#userRoleXmselect',
            name: 'role_code',
            direction: 'up',
            data: res.data,
            height: '200px',
            initValue: v, 
            prop: {
              name: "name",
              value: "code",
              children: "list"
            }
          });
        }
      }); 
    });
  }



  layui.data.UserOrgDone = function (d) {

    layui.use(['admin', 'form', 'xmSelect'], function () {
      var $ = layui.$
        , admin = layui.admin
        , view = layui.view
        , form = layui.form
        , xmSelect = layui.xmSelect;

      var v;
      if (d.params.org_code) {
        v = d.params.org_code.split(",")
      }

      admin.req({
        url: '/inet/services/user/org' //模拟接口
        , type: 'get'
        , contentType: 'application/json;charset=UTF-8'
        , done: function (res) {
          roleOrgXmselect = xmSelect.render({
            el: '#userOrgXmselect',
            name: 'org_code',
            direction: 'up',
            data: res.data,
            height: '200px',
            initValue: v,
            tree: {
              //是否严格遵守父子模式
              strict: false,
              show: true
            },
            prop: {
              name: "name",
              value: "code",
              children: "list"
            }
          });
        }
      });
    });


  }


  layui.use(['admin', 'form', 'xmSelect'], function () {
    var $ = layui.$
      , admin = layui.admin
      , view = layui.view
      , form = layui.form
      , xmSelect = layui.xmSelect;


    form.verify({
      phonemsg: function (value, item) { //value：表单的值、item：表单的DOM对象
        if (value != "") {  //值不是空的时候再去走验证
          if (!/^1\d{10}$/.test(value)) {
            return '\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7';
          }
        }
      },
      emailmsg: function (value, item) { //value：表单的值、item：表单的DOM对象
        if (value != "") {  //值不是空的时候再去走验证
          if (!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(value)) {
            return '\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e';
          }
        }
      }
    })

  });
</script>