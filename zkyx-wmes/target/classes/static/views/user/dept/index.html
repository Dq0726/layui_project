

<title>组织管理</title>
  
<div class="layui-card layadmin-header">
  <div class="layui-breadcrumb" lay-filter="breadcrumb">
    <a lay-href="">主页</a>
    <a><cite>用户</cite></a>
    <a><cite>组织管理</cite></a>
  </div>
</div>

<div class="layui-fluid">   
  <div class="layui-card"> 
    <div class="layui-card-body"> 
      <table id="user-dept-table" lay-filter="user-dept-table"></table>  
 
	  <script type="text/html" id="user-dept-toolbar-head">
	    <div class="layui-btn-container"> 
		  <button class="layui-btn layui-btn-sm" lay-event="addroot">新增组织</button> 
		  <button class="layui-btn layui-btn-sm" lay-event="refresh">刷新</button>
	    </div>
	  </script>
	 
      <script type="text/html" id="user-dept-toolbar-row">
        <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="addsub"><i class="layui-icon layui-icon-addition"></i>添加</a>
        <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit"><i class="layui-icon layui-icon-edit"></i>编辑</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
      </script>
    </div>
  </div>
</div>

<script>
layui.use(['admin'], function(){
  var $ = layui.$
  ,admin = layui.admin
  ,view = layui.view
  ,form = layui.form
  ,treeTable = layui.treeTable;
  
  
  //组织管理
  var insTb = treeTable.render({
    elem: '#user-dept-table'
    ,url: '/inet/services/dept/list' //模拟接口
  	,toolbar: '#user-dept-toolbar-head'
    ,defaultToolbar: ['filter', 'print', 'exports', {
         title: '提示',
         layEvent: 'LAYTABLE_TIPS',
         icon: 'layui-icon-tips'
     }]
    , height: 'full-200'
    ,tree: { 
        customName: { 
           id: 'id'//父ID
          ,pid: 'pid'//子ID   
        }
       ,data: {
    	   isSimpleData: true	
    	   ,rootPid: '3'
       }
       ,view: { 
    	   expandAllDefault: true
       }
       
    } 
    ,cols: [[
       {type: 'numbers'}  
      ,{field: 'name', title: '组织名'}
      , { field: 'code', title: '标识' }
      ,{field: 'sort', title: '排序'} 
      ,{title: '操作', width: 225, align: 'center', fixed: 'right', toolbar: '#user-dept-toolbar-row'}
    ]] 
    ,style: 'margin-top:0;'
  });

  //工具条
  treeTable.on('tool(user-dept-table)', function(obj){
    var data = obj.data;
    if(obj.event === 'del'){
      layer.confirm('确定删除此组织？', function(index){ 
        admin.req({
	        url: '/inet/services/dept/' +  data.id//实际使用请改成服务端真实接口
	        , type: 'delete'
	        , contentType: 'application/json;charset=UTF-8' 
	        , done: function (res) {
	          layer.msg("删除成功");
	          layui.treeTable.reload('user-dept-table'); //重载表格
              layer.close(index); //执行关闭 
	        }
	      }); 
      });
    }else if(obj.event === 'addsub'){
        admin.popup({
            title: '添加新组织'
            ,area: ['500px', '530px']
            ,id: 'popup-user-dept-addsub'
            ,success: function(layero, index){
              view(this.id).render('user/dept/add-form', data).done(function(){
                form.render(null, 'user-dept-add-form');
                
                //提交
                form.on('submit(user-dept-add-form-submit)', function(data){ 
               	  var field = data.field; //获取提交的字段  
                  //提交 Ajax 成功后，关闭当前弹层并重载表格
                 //提交修改 
			      admin.req({
			        url: '/inet/services/dept' //实际使用请改成服务端真实接口
			        , type: 'post'
			        , contentType: 'application/json;charset=UTF-8'
			        , data: JSON.stringify(field)
			        , done: function (res) {
			          layer.msg("新增成功");
			          layui.treeTable.reload('user-dept-table'); //重载表格
	                  layer.close(index); //执行关闭 
			        }
			      }); 
                });
              });
            }
          });
       }else if(obj.event === 'edit'){
      admin.popup({
        title: '编辑组织'
        ,area: ['500px', '480px']
        ,id: 'popup-user-dept-edit'
        ,success: function(layero, index){
          view(this.id).render('user/dept/edit-form', data).done(function(){
            form.render(null, 'user-dept-edit-form');
            
            //提交
            form.on('submit(user-dept-edit-form-submit)', function(data){
              var field = data.field; //获取提交的字段  
              //提交 Ajax 成功后，关闭当前弹层并重载表格
              //提交修改 
		      admin.req({
		        url: '/inet/services/dept' //实际使用请改成服务端真实接口
		        , type: 'put'
		        , contentType: 'application/json;charset=UTF-8'
		        , data: JSON.stringify(field)
		        , done: function (res) {
		          layer.msg("修改成功");
		          layui.treeTable.reload('user-dept-table'); //重载表格
                  layer.close(index); //执行关闭 
		        }
		      });
            });
          });
        }
      });
    }
  });

   
  // 头部工具栏点击事件
  treeTable.on('toolbar(user-dept-table)', function (obj) {
	  switch (obj.event) {
      case 'addroot':
    	  admin.popup({
    	        title: '添加新组织'
    	        ,area: ['500px', '480px']
    	        ,id: 'popup-user-dept-addroot'
    	        ,success: function(layero, index){
    	          view(this.id).render('user/dept/add-form').done(function(){
    	            form.render(null, 'user-dept-add-form'); 
    	            //提交
    	            form.on('submit(user-dept-add-form-submit)', function(data){
    	              var field = data.field; //获取提交的字段 
    	              //提交 Ajax 成功后，关闭当前弹层并重载表格
    	              admin.req({
    				        url: '/inet/services/dept' //实际使用请改成服务端真实接口
    				        , type: 'post'
    				        , contentType: 'application/json;charset=UTF-8'
    				        , data: JSON.stringify(field)
    				        , done: function (res) {
    				          layer.msg("新增成功");
    				          layui.treeTable.reload('user-dept-table'); //重载表格
    		                  layer.close(index); //执行关闭 
    				        }
    				      });
    	            });
    	          });
    	        }
    	      });
          break;
      case 'delete':
          layer.msg('删除');
          break;
      case 'update':
          layer.msg('编辑');
          break;
      case 'LAYTABLE_TIPS':
          layer.msg('提示');
          break;
  	}    
  });
  
   
   
});
</script>