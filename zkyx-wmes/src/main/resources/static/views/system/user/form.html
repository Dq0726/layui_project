<div class="layui-form" lay-filter="system-user-edit-form" style="padding: 20px 30px 0 0">
  <div class="layui-form-item">
    <label class="layui-form-label">用户名称</label>
    <div class="layui-input-block">
      <input
        type="text"
        name="userId"
        placeholder="请输入"
        style="display: none"
        autocomplete="off"
        class="layui-input"
      />
      <input
        type="text"
        name="userName"
        lay-verify="required"
        placeholder="请输入用户名"
        autocomplete="off"
        class="layui-input"
      />
    </div>
  </div>

  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">用户昵称</label>
      <div class="layui-input-inline">
        <input type="text" name="nickName" placeholder="请输入用户名" autocomplete="off" class="layui-input" />
      </div>
    </div>
    <div class="layui-inline">
      <label class="layui-form-label">归属部门</label>
      <div class="layui-input-inline">
        <div id="deptXmselect" class="xm-select-demo"></div>
      </div>
    </div>
  </div>

  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">手机号码</label>
      <div class="layui-input-inline">
        <input
          type="text"
          name="phonenumber"
          lay-verify="phonemsg"
          placeholder="请输入号码"
          autocomplete="off"
          class="layui-input"
        />
      </div>
    </div>
    <div class="layui-inline">
      <label class="layui-form-label">邮箱</label>
      <div class="layui-input-inline">
        <input type="text" name="email" placeholder="请输入号码" autocomplete="off" class="layui-input" />
      </div>
    </div>
  </div>

  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">性别1</label>
      <div class="layui-input-block">
        <input type="radio" name="sex" value="1" title="男" />
        <input type="radio" name="sex" value="2" title="女" />
        <input type="radio" name="sex" value="0" title="未知" checked />
      </div>
    </div>
    <div class="layui-inline">
      <label class="layui-form-label">状态</label>
      <div class="layui-input-inline">
        <input type="radio" name="status" value="0" title="正常" checked />
        <input type="radio" name="status" value="1" title="停用" />
      </div>
    </div>
  </div>

  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">岗位</label>
      <div class="layui-input-inline">
        <div id="postXmselect" class="xm-select-demo"></div>
      </div>
    </div>
    <div class="layui-inline">
      <label class="layui-form-label">角色</label>
      <div class="layui-input-inline">
        <div id="roleXmselect" class="xm-select-demo"></div>
      </div>
    </div>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label">备注</label>
    <div class="layui-input-block">
      <script type="text/html" template>
        <textarea type="text" name="remarks" autocomplete="off" class="layui-textarea">
{{ d.params.remarks || '' }}</textarea
        >
      </script>
    </div>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label"></label>
    <div class="layui-input-inline">
      <input
        type="button"
        lay-submit
        id="system-user-form-submit"
        lay-filter="system-user-form-submit"
        value="确认"
        class="layui-btn"
      />
    </div>
  </div>
</div>

<script type="text/html" template lay-done="systemUserFromDone(d.params)"></script>

<script>
  systemUserFromDone = function (params) {
    layui.use(["admin", "form", "xmSelect"], function () {
      var $ = layui.$,
        admin = layui.admin,
        view = layui.view,
        form = layui.form,
        xmSelect = layui.xmSelect;

      var deptXmselect = xmSelect.render({
        el: "#deptXmselect",
        name: "deptId",
        radio: true,
        tree: {
          //是否严格遵守父子模式
          strict: false,
          show: true,
        },
        prop: {
          name: "label",
          value: "id",
          children: "children",
        },
      });

      var postXmselect = xmSelect.render({
        el: "#postXmselect",
        name: "postIds",
        radio: true,
        prop: {
          name: "postName",
          value: "postId",
        },
      });

      var roleXmselect = xmSelect.render({
        el: "#roleXmselect",
        name: "roleIds",
        radio: true,
        prop: {
          name: "roleName",
          value: "roleId",
        },
      });

      //获取部门列表
      admin.req({
        url: "/system/dept/tree",
        type: "get",
        contentType: "application/json;charset=UTF-8",
        done: function (res) {
           deptXmselect.update({
        		data: res.data
        	});  
        },
      });

      //获取岗位列表
      admin.req({
        url: "/system/post/list1",
        type: "get",
        contentType: "application/json;charset=UTF-8",
        done: function (res) {
          postXmselect.update({
            data: res.data,
          });
        },
      });

      //获取角色列表
      admin.req({
        url: "/system/role/list1",
        type: "get",
        contentType: "application/json;charset=UTF-8",
        done: function (res) {
          roleXmselect.update({
            data: res.data,
          });
        },
      });

      if (params.userId != null && params.userId != "") {
        admin.req({
          url: "/system/user/" + params.userId,
          type: "get",
          
          contentType: "application/json;charset=UTF-8",
          done: function (res) {
            form.val("system-user-edit-form", res.data);

            var deptIds = res.data.deptId;
              
            if (deptIds) { 
              deptIds = (deptIds + "").split(",");
              deptXmselect.setValue(deptIds);
            }
 
            postXmselect.setValue(res.postIds);
            roleXmselect.setValue(res.roleIds);
            
            form.render();
            
            
          },
        });
      }

     
    });
  };

  layui.use(["admin", "form", "xmSelect"], function () {
    var $ = layui.$,
      admin = layui.admin,
      view = layui.view,
      form = layui.form;
  });
</script>
