<div class="layui-form" lay-filter="zkmes-techniquemgmt-technique-composeinfo-form" style="padding: 20px 30px 0 0">
  <div class="layui-form-item layui-hide">
    <label class="layui-form-label">工艺组ID</label>
    <div class="layui-input-block">
      <script type="text/html" template>
        <input
          type="text"
          name="techniquegroupId"
          placeholder="请输入"
          value="{{ d.params.techniquegroupId || '' }}"
          autocomplete="off"
          class="layui-input"
        />
      </script>
    </div>
  </div>

  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">工序序号<span class="required">*</span></label>
      <div class="layui-input-inline">
        <script type="text/html" template>
          <input
            type="number"
            min="1"
            name="sort"
            placeholder="请输入"
            value="{{ d.params.sort || '' }}"
            lay-verify="required"
            class="layui-input"
          />
        </script>
      </div>
    </div>

    <div class="layui-inline">
      <label class="layui-form-label">工序名称<span class="required">*</span></label>
      <div class="layui-input-inline">
        <script type="text/html" template>
          <input
            type="text"
            lay-affix="search"
            lay-filter="searchProcess"
            lay-verify="required"
            readonly
            placeholder="请选择"
            value="{{ d.params.processName || '' }}"
            name="processName"
            lay-options="{split: true}"
            class="layui-input"
          />
          <input
            type="text"
            lay-verify="required"
            readonly
            value="{{ d.params.processVersionId || '' }}"
            name="processVersionId"
            class="layui-input layui-hide"
          />
        </script>
      </div>
    </div>

    <div class="layui-inline">
      <label class="layui-form-label">工序版本<span class="required">*</span></label>
      <div class="layui-input-inline">
        <script type="text/html" template>
          <input
            type="text"
            disabled
            value="{{ d.params.processVersion || '' }}"
            name="processVersion"
            class="layui-input"
          />
        </script>
      </div>
    </div>

    <div class="layui-inline">
      <label class="layui-form-label">工序关系<span class="required">*</span></label>
      <div class="layui-input-inline">
        <div id="processrelModelXmselect" class="xm-select-demo"></div>
      </div>
    </div>
  </div>

  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">关键工序</label>
      <div class="layui-input-inline">
        <input type="radio" name="key" value="0" title="是" checked />
        <input type="radio" name="key" value="1" title="否" />
      </div>
    </div>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label">备注</label>
    <div class="layui-input-block">
      <script type="text/html" template>
        <textarea type="text" name="remark" autocomplete="off" class="layui-textarea">
{{ d.params.remark || '' }}</textarea
        >
      </script>
    </div>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label"></label>
    <div class="layui-input-inline">
      <input
        type="button"
        id="zkmes-techniquemgmt-technique-composeinfo-form-submit"
        lay-submit
        lay-filter="zkmes-techniquemgmt-technique-composeinfo-form-submit"
        value="确认"
        class="layui-btn"
      />
    </div>
  </div>
</div>

<script
  type="text/html"
  template
  lay-done="techniquemgmtTechniqueComposeinfoParamsDone(d.params)"
></script>

<script>
techniquemgmtTechniqueComposeinfoParamsDone = function (params) {
    layui.use(["admin", "form", "xmSelect"], function () {
      var $ = layui.$,
        admin = layui.admin,
        view = layui.view,
        form = layui.form,
        table = layui.table,
        xmSelect = layui.xmSelect;

      form.on("input-affix(searchProcess)", function (data) {
        admin.popup({
          title: "选择工序",
          area: "1500px",
          offset: "100px",
          id: "popup-zkmes-techniquemgmt-technique-process",
          success: function (layero, index) {
            view(this.id)
              .render("zkmes/techniquemgmt/technique/process-form")
              .done(function () {
                form.render(null, "zkmes-techniquemgmt-technique-process-form");
                //提交
                form.on("submit(zkmes-techniquemgmt-technique-process-form-submit)", function (data) {
                  var field = data.field; //获取提交的字段
                  //提交 Ajax 成功后，关闭当前弹层并重载表格
                  form.val("zkmes-techniquemgmt-technique-composeinfo-form", field);
                  layer.close(index); //执行关闭
                });
              });
          },
        });
      });

      ///////processrelId
      var processrelIds = params.processrelId + "";
      if (processrelIds) {
        processrelIds = processrelIds.split(",");
      }

      admin.req({
        url: "/zkmes/techniquemgmt/processrel/list1",
        type: "get",
        contentType: "application/json;charset=UTF-8",
        done: function (res) {
          processlrelModelXmselect = xmSelect.render({
            el: "#processrelModelXmselect",
            name: "processrelId",
            data: res.data,
            radio: true,
            initValue: processrelIds,
            prop: {
              name: "processrelName",
              value: "processrelId",
            },
          });
        },
      });

      if (params.key != null) {
        $("input[name=key][value=0]").attr("checked", params.key == 0 ? true : false);
        $("input[name=key][value=1]").attr("checked", params.key == 1 ? true : false);
      }
    });
  };

  layui.use(["admin", "form"], function () {
    var $ = layui.$,
      admin = layui.admin,
      view = layui.view,
      form = layui.form;
  });
</script>
