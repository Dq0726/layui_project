<div
  class="layui-form"
  lay-filter="zkmes-planschedulingmgmt-productionplan-add-form"
  style="padding: 10px 30px 0 0"
>
  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">计划订单前缀</label>
      <div class="layui-input-inline">
        <input
          type="text"
          name="productionplanId"
          lay-verify="required"
          placeholder="请输入"
          autocomplete="off"
          class="layui-input"
        />
      </div>
    </div>

    <div class="layui-inline">
      <label class="layui-form-label">计划订单名称</label>
      <div class="layui-input-inline">
        <input
          type="text"
          name="productionplanName"
          lay-verify="required"
          placeholder="请输入"
          autocomplete="off"
          class="layui-input"
        />
      </div>
    </div>

    <div class="layui-inline">
      <label class="layui-form-label">批次号</label>
      <div class="layui-input-inline">
        <input
          type="text"
          name="batchno"
          placeholder="请输入"
          autocomplete="off"
          class="layui-input"
        />
      </div>
    </div>
  </div>

  <script type="text/html" template>
    {{# if(d.params.source == 0){ }}

    <div class="layui-form-item">
      <div class="layui-inline">
        <label class="layui-form-label">客户名称</label>
        <div class="layui-input-inline">
          <div id="customerXmselect" class="xm-select-demo"></div>
        </div>
      </div>

      <div class="layui-inline">
        <label class="layui-form-label">客户订单号</label>
        <div class="layui-input-inline">
          <input
            type="text"
            name="customerorderId"
            lay-verify="required"
            placeholder="请输入"
            autocomplete="off"
            class="layui-input"
          />
        </div>
      </div>
    </div>
    {{# } }}
  </script>

  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">产品编号</label>
      <div class="layui-input-inline">
        <input
          type="text"
          lay-affix="search"
          lay-filter="searchProduct"
          lay-verify="required"
          readonly
          placeholder="请搜索"
          name="productId"
          lay-options="{split: true}"
          class="layui-input"
        />
      </div>
    </div>

    <div class="layui-inline">
      <label class="layui-form-label">产品名称</label>
      <div class="layui-input-inline">
        <input
          type="text"
          name="productName"
          disabled
          placeholder="请输入"
          class="layui-input"
        />
      </div>
    </div>

    <div class="layui-inline">
      <label class="layui-form-label">计划数量</label>
      <div class="layui-input-inline">
        <input
          type="text"
          name="productionQty"
          lay-verify="required"
          placeholder="请输入"
          autocomplete="off"
          class="layui-input"
        />
      </div>
    </div>
  </div>

  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">预计生产日期</label>
      <div class="layui-input-inline">
        <input
          type="text"
          id="ID-laydate-epd"
          placeholder="请输入"
          name="epd"
          autocomplete="off"
          class="layui-input"
        />
      </div>
    </div>

    <div class="layui-inline">
      <label class="layui-form-label">预计结束日期</label>
      <div class="layui-input-inline">
        <input
          type="text"
          id="ID-laydate-eed"
          placeholder="请输入"
          name="eed"
          autocomplete="off"
          class="layui-input"
        />
      </div>
    </div>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label">备注</label>
    <div class="layui-input-block">
      <textarea
        type="text"
        name="remark"
        autocomplete="off"
        class="layui-textarea"
      ></textarea>
    </div>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label"></label>
    <div class="layui-input-inline">
      <input
        type="button"
        id="zkmes-planschedulingmgmt-productionplan-add-form-submit"
        lay-submit
        lay-filter="zkmes-planschedulingmgmt-productionplan-add-form-submit"
        value="确认"
        class="layui-btn"
      />
    </div>
  </div>
</div>

<script
  type="text/html"
  template
  lay-done="layui.data.sendZkmesInvmgmtProductionplanAddFormParams(d.params)"
></script>

<script>
  layui.data.sendZkmesInvmgmtProductionplanAddFormParams = function (params) {
    layui.use(["admin", "form", "xmSelect"], function () {
      var $ = layui.$,
        admin = layui.admin,
        view = layui.view,
        table = layui.table,
        form = layui.form,
        xmSelect = layui.xmSelect;

      admin.req({
        url: "/zkmes/customermgmt/list1",
        type: "get",
        contentType: "application/json;charset=UTF-8",
        done: function (res) {
          customerXmselect = xmSelect.render({
            el: "#customerXmselect",
            name: "customerId",
            data: res.data,
            radio: true,
            prop: {
              name: "customerName",
              value: "customerId",
            },
          });
        },
      });
    });
  };

  layui.use(["admin", "form"], function () {
    var $ = layui.$,
      admin = layui.admin,
      view = layui.view,
      table = layui.table,
      laydate = layui.laydate,
      form = layui.form;

    laydate.render({
      elem: "#ID-laydate-epd",
      type: "datetime",
      fullPanel: true,
    });

    laydate.render({
      elem: "#ID-laydate-eed",
      type: "datetime",
      fullPanel: true,
    });

    // 输入框点缀事件 - 搜索示例
    form.on("input-affix(searchProduct)", function (data) {
      admin.popup({
        title: "添加生产计划信息",
        area: "1500px",
        offset: "100px",
        id: "popup-zkmes-planschedulingmgmt-productionplan-product",
        success: function (layero, index) {
          view(this.id)
            .render("zkmes/planschedulingmgmt/productionplan/product-form")
            .done(function () {
              form.render(
                null,
                "zkmes-planschedulingmgmt-productionplan-product-form"
              );
              //提交
              form.on(
                "submit(zkmes-planschedulingmgmt-productionplan-product-form-submit)",
                function (data) {
                  var field = data.field; //获取提交的字段
                  //提交 Ajax 成功后，关闭当前弹层并重载表格

                  form.val(
                    "zkmes-planschedulingmgmt-productionplan-add-form",
                    field
                  );
                  layer.close(index); //执行关闭
                }
              );
            });
        },
      });
    });
  });
</script>
