<script type="text/html" template>
      <link
        rel="stylesheet"
        href="{{ layui.setter.paths.core }}css/register.css?v={{ layui.admin.v }}"
        media="all"
      />
    </script>

<div class="layui-form" lay-filter="uia-register-form" style="margin: 16px;">

  <input type="text" name="uuid" id="uuid" class="layui-hide">
        
  <div class="layui-form-item">
    <div class="layui-input-wrap">
      <div class="layui-input-prefix">
        <i class="layui-icon layui-icon-user"></i>
      </div>
      <input type="text" name="username" value="" lay-verify="required" placeholder="请输入用户账号" lay-reqtext="请输入用户账号"
        autocomplete="off" class="layui-input" lay-affix="clear">
    </div>
  </div>

  <div class="layui-form-item">
    <div class="layui-input-wrap">
      <div class="layui-input-prefix">
        <i class="layui-icon layui-icon-username"></i>
      </div>
      <input type="text" name="nickname" value="" lay-verify="required" placeholder="请输入用户姓名" lay-reqtext="请输入用户姓名"
        autocomplete="off" class="layui-input" lay-affix="clear">
    </div>
  </div>
  <div class="layui-form-item">
    <div class="layui-input-wrap">
      <div class="layui-input-prefix">
        <i class="layui-icon layui-icon-username"></i>
      </div>
      <input type="text" name="phonenumber" lay-verify="required|phone" placeholder="手机号" class="layui-input"
        lay-reqtext="请填写手机号" autocomplete="off" lay-affix="clear" value="13344445555">
    </div>
  </div>
  <div class="layui-form-item">
    <div class="layui-row">
      <div class="layui-col-xs7">
        <div class="layui-input-wrap">
          <div class="layui-input-prefix">
            <i class="layadmin-user-login-icon layui-icon layui-icon-vercode" for="LAY-user-login-vercode"></i>
          </div>
          <input type="text" name="code" id="LAY-user-login-vercode" lay-verify="required" placeholder="图形验证码"
            class="layui-input" />
        </div>
      </div>
      <div class="layui-col-xs5">
        <div style="margin-left: 10px;">
          <img src="" class="registerCode " width="100" lay-on="registerCode" />
        </div>
      </div>
    </div>
  </div>
  <div class="layui-form-item">
    <div class="layui-input-wrap">
      <div class="layui-input-prefix">
        <i class="layui-icon layui-icon-password"></i>
      </div>
      <input type="password" name="password" value="" lay-verify="required" placeholder="密   码" lay-reqtext="请填写密码"
        autocomplete="off" class="layui-input" lay-affix="eye">
    </div>
  </div>

  <div class="layui-form-item">
    <div class="layui-input-wrap">
      <div class="layui-input-prefix">
        <i class="layui-icon layui-icon-password"></i>
      </div>
      <input type="password" name="repass" value="" lay-verify="required" placeholder="确认密码" lay-reqtext="请填写密码"
        autocomplete="off" class="layui-input" lay-affix="eye">
    </div>
  </div>
  <div class="layui-form-item">
    <button class="layui-btn layui-btn-fluid main-btn" lay-submit lay-filter="uia-register-form-submit">注册</button>
    <button class="layui-btn layui-btn-fluid main-btn layui-hide" lay-submit id="uia-register-form-submit1"
      lay-filter="uia-register-form-submit1">注册</button>

  </div>
</div>
<script>
  layui.use(['admin', 'form', "util"], function () {
    var $ = layui.$
      , setter = layui.setter
      , admin = layui.admin
      , util = layui.util
      , form = layui.form;


    form.render();
    var uuid = "";

    //请求登入接口
    admin.req({
      url: "/captchaImage?type=math&s=" + Math.random(), //实际使用请改成服务端真实接口
      type: "get",
      contentType: "application/json;charset=UTF-8",
      done: function (res) {
        console.log(res);
        uuid = res.uuid;
        $(".registerCode").attr("src", "data:image/pnf;base64," + res.img);
      },
    });

    //提交
    form.on('submit(uia-register-form-submit)', function (obj) {
      var field = obj.field;


      //确认密码
      if (field.password !== field.repass) {
        return layer.alert('两次密码输入不一致');
      }

      //是否同意用户协议
      /*  if(!field.agreement){
         return layer.msg('你必须同意用户协议才能注册');
       } */

      var submit = $("#uia-register-form-submit1")
      $("#uuid").val(uuid);
      
      submit.trigger('click');

      return false;
    });
    util.on("lay-on", {
      registerCode: function () {
        admin.req({
          url: "/captchaImage?type=math&s=" + Math.random(), //实际使用请改成服务端真实接口
          type: "get",
          contentType: "application/json;charset=UTF-8",
          done: function (res) {
            uuid = res.uuid;
            $(".registerCode").attr("src", "data:image/pnf;base64," + res.img);
          },
        });
      },

    });
  });
</script>